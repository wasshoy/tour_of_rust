<html lang="fr">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155199982-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-155199982-1');
        </script>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preload" as="font" href="https://fonts.gstatic.com/s/neuton/v12/UMBQrPtMoH62xUZKdK0vfQr4LLkw6A.woff2"/>
        <link rel="preload" as="font" href="https://fonts.gstatic.com/s/neuton/v12/UMBTrPtMoH62xUZCz4g6UCj1Bg.woff2"/>
        <link href="https://fonts.googleapis.com/css2?family=Neuton:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:wght@400;700&display=swap" rel="stylesheet">
        <title>Tour de WebAssembly - Let's go on an adventure!</title>
        <link rel="stylesheet" href="tour.css">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.0.3/build/styles/pojoaque.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
    </head>
    <body>
        <div class="tour">
            <div class="header">
                <span class="title"><a href="00_fr.html">Tour de WebAssembly</a></span>
                <span class="nav">
                <span class="toc"><a href="TOC_fr.html">Table des Matières</a></span>
            </div>
            <div class="page">
            <h1>Appel de fonctions</h1>
            <p>Lorsque nous voulons appeler une fonction dynamique, nous avons besoin
de connaître sa position (fn_handle dans le code) dans le tableau contenant
les fonctions dynamiques ainsi que ses arguments.</p>
<p>Encore une fois, étant donné que WebAssembly ne peut transmettre que des
nombres et que tous les nombres en JavaScript sont des flottants 64 bits,
la signature de la fonction pour l'appel des fonctions dynamiques est donc:</p>
<pre><code>js_invoke_with_2_params(fn_handle:f64, a:f64, b:f64) -&gt; f64
</code></pre>
<p>Notre code Rust devient:</p>
<pre><code class="rust language-rust">let log_handle = register_function("
  (param_a, param_b) =&gt; {
    // appel de console_log ici
  }");

let msg = "hello world";

js_invoke_with_2_params( log_handle,msg.as_ptr() as f64, 
    msg.len() as f64 );
</code></pre>
<p>Il y a cependant un problème. En effet, notre fonction JavaScript à appeler
(celle affichant le console log) doit récupérer le message à afficher depuis
la mémoire. Elle connait la postition du message dans la mémoire ainsi que sa
taille, mais comment récupérer le message? Nous utiliserons pour cela un
contexte!</p>
            <div class="bottomnav">
                <span class="back"><a href="21_fr.html">❮ Précédant</a></span>
                <span class="next"><a href="23_fr.html">Suivant ❯</a></span>
            </div>
            </div>
            <div class="code"><center><br><br><br><br><br><img src="/ferris_lofi.png"><br><br><br><br><br></center></div>
        </div>
    </body>
    <script src="/tour.js"></script>
</html>